JavaScript Syntax Error
The error Uncaught SyntaxError: Unexpected identifier 'steps' suggests there's an issue with how the schema JSON is being passed. Fix the template:

html
<!-- Line ~13-15 in your template -->
<script>
// Initialize with existing schema
let schema = {% if schema_json %}{{ schema_json|tojson|safe }}{% else %}{}{% endif %} || {
    meta: {},
    inputs: [],
    steps: [],
    tax_tables: {},
    output: ''
};

const exampleSchema = {% if example_schema %}{{ example_schema|tojson|safe }}{% else %}{}{% endif %};

// Available data sources from the database
const availableSources = {% if available_sources %}{{ available_sources|tojson|safe }}{% else %}[]{% endif %};
3. Function Definition Errors
The functions (addInput, addStep, etc.) are not defined because they're inside the DOMContentLoaded event listener. Move them outside:

javascript
// GLOBAL FUNCTION DECLARATIONS (move these outside the DOMContentLoaded)

function addInput(data = null) {
    // Implementation
}

function addStep(type, data = null) {
    // Implementation
}

function addTaxTable(name = null, brackets = null) {
    // Implementation
}

// Then inside DOMContentLoaded:
document.addEventListener('DOMContentLoaded', function() {
    loadSchemaToEditor();
    updateJsonPreview();
    initializeSortable();
});
4. Complete Fixed JavaScript Structure
Here's the corrected structure:

javascript
<script>
// ========== GLOBAL VARIABLES ==========
let schema = {% if schema_json %}{{ schema_json|tojson|safe }}{% else %}{
    meta: {},
    inputs: [],
    steps: [],
    tax_tables: {},
    output: ''
}{% endif %};

const exampleSchema = {% if example_schema %}{{ example_schema|tojson|safe }}{% else %}{}{% endif %};
const availableSources = {% if available_sources %}{{ available_sources|tojson|safe }}{% else %}[]{% endif %};

let inputCounter = 0;
let stepCounter = 0;
let tableCounter = 0;
let inputsSortable = null;
let stepsSortable = null;

// ========== GLOBAL FUNCTIONS ==========
function addInput(data = null) {
    const container = document.getElementById('inputs-container');
    const id = inputCounter++;
    
    // ... rest of addInput function ...
}

function addStep(type, data = null) {
    const container = document.getElementById('steps-container');
    const id = stepCounter++;
    
    // ... rest of addStep function ...
}

function addTaxTable(name = null, brackets = null) {
    const container = document.getElementById('tax-tables-container');
    const id = tableCounter++;
    
    // ... rest of addTaxTable function ...
}

// ... all other functions (removeInput, moveInputUp, etc.) ...

function initializeSortable() {
    // ... Sortable initialization ...
}

function loadSchemaToEditor() {
    // ... load schema ...
}

function updateJsonPreview() {
    // ... update preview ...
}

// ========== EVENT LISTENERS ==========
document.addEventListener('DOMContentLoaded', function() {
    loadSchemaToEditor();
    updateJsonPreview();
    initializeSortable();
});

// ... any other event handlers ...
</script>